//= require app
//= require bootstrap/bootstrap.min
//= require bootstrap/bootstrap-hover-dropdown.js
//= require plugins/dropify/dropify.min
//= require plugins/moment/moment.min

//= require plugins/moment/moment-timezone-with-data-2010-2020.min.js
//= require plugins/datepicker/daterangepicker

//= require plugins/datatable/jquery.dataTables.min
//= require plugins/datatable/dataTables.bootstrap.min
//= require plugins/datatable/dataTables.responsive.min

//= require plugins/datatable/dataTables.buttons.min.js
//= require plugins/datatable/buttons.flash.min.js
//= require plugins/datatable/buttons.html5.min.js
//= require plugins/datatable/buttons.print.min.js
//= require plugins/datatable/dataTables.fixedHeader.min.js
//= require plugins/datatable/jszip.min.js
//= require plugins/datatable/pdfmake.min.js
//= require plugins/datatable/vfs_fonts.js

//= require data-confirm-modal
//= require plugins/iCheck/icheck.min
//= require jquery.plugin.js
//= require plugins/select2/select2.full.min.js
//= require animated-headlines
//= require crew/users.coffee

$(function() {
    //Flat red color scheme for iCheck
    $('input[type="checkbox"].flat-red, input[type="radio"].flat-red').iCheck({
      checkboxClass: 'icheckbox_flat-green',
      radioClass   : 'iradio_flat-green'
    });


    $('.select2').select2();
    $('#table_ecej').DataTable({
        "oLanguage": {
            "sEmptyTable": "Nenhum registro encontrado",
            "sInfo": "Mostrando de _START_ até _END_ de _TOTAL_ registros",
            "sInfoEmpty": "Mostrando 0 até 0 de 0 registros",
            "sInfoFiltered": "(Filtrados de _MAX_ registros)",
            "sInfoPostFix": "",
            "sInfoThousands": ".",
            "sLengthMenu": "Mostrando _MENU_ resultados",
            "sLoadingRecords": "Carregando...",
            "sProcessing": "Processando...",
            "sZeroRecords": "Nenhum registro encontrado",
            "sSearch": "Pesquisar",
            "oPaginate": {
                "sNext": "Próximo",
                "sPrevious": "Anterior",
                "sFirst": "Primeiro",
                "sLast": "Último"
            },
            "oAria": {
                "sSortAscending": ": Ordenar colunas de forma ascendente",
                "sSortDescending": ": Ordenar colunas de forma descendente"
            }
        },
        "paging": true,
        "lengthChange": true,
        "searching": true,
        "ordering": true,
        "info": true,
        "autoWidth": true,
        "responsive": true,
        "pageLength": 50,
        dom: "Bfrtip",
              buttons: [
                {
                    extend: 'csv',
                    title: 'SEMANAS 2017 - CSV - '+ moment().format('DD/MM/YYYY HH:mm:ss') + ' - '+$('.box-title').html(),
                    exportOptions: {
                        columns: "thead th:not(.noExport)"
                    }
                },
                {  
                     extend: 'excel',
                    title: 'SEMANAS 2017 - EXCEL - '+ moment().format('DD/MM/YYYY HH:mm:ss') + ' - '+$('.box-title').html(),
                    exportOptions: {
                        columns: "thead th:not(.noExport)"
                    }
                },

                {
                    extend: 'pdf',
                    title: 'SEMANAS 2017 - PDF - '+ moment().format('DD/MM/YYYY HH:mm:ss') + ' - '+$('.box-title').html(),
                    exportOptions: {
                        columns: "thead th:not(.noExport)"
                    }
                }
              ]
    });

    $('#table_ecej1').DataTable({
        "oLanguage": {
            "sEmptyTable": "Nenhum registro encontrado",
            "sInfo": "Mostrando de _START_ até _END_ de _TOTAL_ registros",
            "sInfoEmpty": "Mostrando 0 até 0 de 0 registros",
            "sInfoFiltered": "(Filtrados de _MAX_ registros)",
            "sInfoPostFix": "",
            "sInfoThousands": ".",
            "sLengthMenu": "Mostrando _MENU_ resultados",
            "sLoadingRecords": "Carregando...",
            "sProcessing": "Processando...",
            "sZeroRecords": "Nenhum registro encontrado",
            "sSearch": "Pesquisar",
            "oPaginate": {
                "sNext": "Próximo",
                "sPrevious": "Anterior",
                "sFirst": "Primeiro",
                "sLast": "Último"
            },
            "oAria": {
                "sSortAscending": ": Ordenar colunas de forma ascendente",
                "sSortDescending": ": Ordenar colunas de forma descendente"
            }
        },
        "paging": true,
        "lengthChange": true,
        "searching": true,
        "ordering": true,
        "info": true,
        "autoWidth": true,
        "responsive": true,
        "pageLength": 50,
        dom: "Bfrtip",
              buttons: [
                {
                    extend: 'csv',
                    title: 'SEMANAS 2017 - CSV - '+ moment().format('DD/MM/YYYY HH:mm:ss') + ' - '+$('.title_1').html(),
                    exportOptions: {
                        columns: "thead th:not(.noExport)"
                    }
                },
                {  
                     extend: 'excel',
                    title: 'SEMANAS 2017 - EXCEL - '+ moment().format('DD/MM/YYYY HH:mm:ss') + ' - '+$('.title_1').html(),
                    exportOptions: {
                        columns: "thead th:not(.noExport)"
                    }
                },

                {
                    extend: 'pdf',
                    title: 'SEMANAS 2017 - PDF - '+ moment().format('DD/MM/YYYY HH:mm:ss') + ' - '+$('.title_1').html(),
                    exportOptions: {
                        columns: "thead th:not(.noExport)"
                    }
                }
              ]
    });

    
    var table =  $('#table_ecej_rooms').DataTable({
        "columnDefs": [
            { "visible": false, "targets": 1 }
        ],
        "oLanguage": {
            "sEmptyTable": "Nenhum registro encontrado",
            "sInfo": "Mostrando de _START_ até _END_ de _TOTAL_ registros",
            "sInfoEmpty": "Mostrando 0 até 0 de 0 registros",
            "sInfoFiltered": "(Filtrados de _MAX_ registros)",
            "sInfoPostFix": "",
            "sInfoThousands": ".",
            "sLengthMenu": "Mostrando _MENU_ resultados",
            "sLoadingRecords": "Carregando...",
            "sProcessing": "Processando...",
            "sZeroRecords": "Nenhum registro encontrado",
            "sSearch": "Pesquisar",
            "oPaginate": {
                "sNext": "Próximo",
                "sPrevious": "Anterior",
                "sFirst": "Primeiro",
                "sLast": "Último"
            },
            "oAria": {
                "sSortAscending": ": Ordenar colunas de forma ascendente",
                "sSortDescending": ": Ordenar colunas de forma descendente"
            }
        },
        "paging": true,
        "lengthChange": true,
        "searching": true,
        "ordering": true,
        "info": true,
        "autoWidth": true,
        "responsive": true,
        "pageLength": 50,
        "drawCallback": function ( settings ) {
            var api = this.api();
            var rows = api.rows( {page:'current'} ).nodes();
            var last=null;
 
            api.column(1, {page:'current'} ).data().each( function ( group, i ) {
                if ( last !== group ) {
                    $(rows).eq( i ).before(
                        '<tr class="group"><td colspan="5">'+group+'</td></tr>'
                    );
 
                    last = group;
                }
            } );
        },
        dom: "Bfrtip",
              buttons: [
                {
                    extend: 'csv',
                    title: 'EFEJ 2017 - CSV - '+ moment().format('DD/MM/YYYY HH:mm:ss') + ' - '+$('.box-title').html(),
                    exportOptions: {
                        columns: "thead th:not(.noExport)"
                    }
                },
                {  
                     extend: 'excel',
                    title: 'EFEJ 2017 - EXCEL - '+ moment().format('DD/MM/YYYY HH:mm:ss') + ' - '+$('.box-title').html(),
                    exportOptions: {
                        columns: "thead th:not(.noExport)"
                    }
                },

                {
                    extend: 'pdf',
                    title: 'EFEJ 2017 - PDF - '+ moment().format('DD/MM/YYYY HH:mm:ss') + ' - '+$('.box-title').html(),
                    exportOptions: {
                        columns: "thead th:not(.noExport)"
                    }
                }
              ]
    });

     // Order by the grouping
    $('#table_ecej_rooms tbody').on( 'click', 'tr.group', function () {
        var currentOrder = table.order()[0];
        if ( currentOrder[0] === 1 && currentOrder[1] === 'asc' ) {
            table.order( [ 1, 'desc' ] ).draw();
        }
        else {
            table.order( [ 1, 'asc' ] ).draw();
        }
    } );
    table.order( [ 1, 'asc' ] ).draw();

   


    dataConfirmModal.setDefaults({
        title: '',
        commit: 'Continuar',
        cancel: 'Cancelar',
        onConfirm: function() { return true },
        onCancel:  function() { return false },
        modalClass: 'patrick-modal'
    });



    //iCheck for checkbox and radio inputs
    $('input[type="checkbox"].minimal').iCheck({
      checkboxClass: 'icheckbox_minimal-blue',
      radioClass: 'iradio_minimal-blue'
    });
});



$('#birthday_picker').daterangepicker({
    locale: {
        format: 'DD/MM/YYYY',
        daysOfWeek: ['Do', 'Se', 'Te', 'Qua', 'Qui', 'Sex', 'Sa'],
        monthNames: ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'],
    },

    singleDatePicker: true,
    showDropdowns: true,
    startDate: moment().subtract(22, 'years'),
    autoUpdateInput: false

}, function(chosen_date) {
    $('#birthday_picker').val(chosen_date.format('DD/MM/YYYY'));
});



function change_payment_parts(sel, price){
    // if(sel.value !== ''){
    //     $("#button_payment_billet").prop("disabled",false);
    // } else {
    //     $("#button_payment_billet").prop("disabled",true);
    // }
    // var txt = '';
    // var txt_parcelas = '';
    // var data_boleto = '';
    // var partions = 0
    // var total = $('#parcelamento_sel option').size() - 1;
    // var data_atual = moment();

    // if (mes1 >= data_atual) {
    //     data_boleto = mes1
    // } else if (mes2 >= data_atual) {
    //     data_boleto = mes2
    // } else if (mes3 >= data_atual) {
    //     data_boleto = mes3
    // } else if (mes4 >= data_atual) {
    //     data_boleto = mes4
    // }

    // partions = sel.value ? sel.value : 1
    // var nohost = $( "input[name='nohost_active']:checked" );
    // var nohost_value = nohost.val();
    // if (typeof nohost_value === "undefined") {
    //    $('#price_js').html((price + (0.00*(partions-1))).toFixed(2));
    // } else {
    //     var text_radio_nohost = nohost.next('div:first').html();
    //     var price_nohost_checked = (parseFloat(text_radio_nohost.split('R$ ')[1]) + 0.0);
    //     console.log(price_nohost_checked);
    //     $('#price_js').html((price_nohost_checked + (0.00*(partions-1))).toFixed(2));
    // }
    

    // // if (partions >= 1) {
    // //     txt += '<div class="radio"><label>';
    // //     txt += '* Vencimento da 1° parcela: ' + data_boleto.format('DD/MM/YYYY') + ' ';
    // //     txt += '</label>';
    // // }

    // // if (partions >= 2) {
    // //     var data_f = data_boleto.add(1, 'month').format('DD/MM/YYYY');
    // //     txt += '<div class="radio"><label>';
    // //     txt += '* Vencimento da 2° parcela: ' + data_f + ' ';
    // //     txt += '</label>';
    // // }

    // // if (partions >= 3) {
    // //     var data_f = data_boleto.add(1, 'month').format('DD/MM/YYYY');
    // //     txt += '<div class="radio"><label>';
    // //     txt += '* Vencimento da 3° parcela: ' + data_f + ' ';
    // //     txt += '</label>';

    // // }

    // // if (partions >= 4) {
    // //     var data_f = data_boleto.add(1, 'month').format('DD/MM/YYYY');
    // //     txt += '<div class="radio"><label>';
    // //     txt += '* Vencimento da 4° parcela: ' + data_f + ' ';
    // //     txt += '</label>';
    // // }

    // if (partions >= 1) {
    //     txt += '<div class="radio"><label>';
    //     txt += '* Vencimento da 1° parcela: ' + mes1.format('DD/MM/YYYY') + ' ';
    //     txt += '</label>';
    // }

    // if (partions >= 2) {
    //     var data_f = mes2.format('DD/MM/YYYY');
    //     txt += '<div class="radio"><label>';
    //     txt += '* Vencimento da 2° parcela: ' + data_f + ' ';
    //     txt += '</label>';
    // }

    // if (partions >= 3) {
    //     var data_f = mes3.format('DD/MM/YYYY');
    //     txt += '<div class="radio"><label>';
    //     txt += '* Vencimento da 3° parcela: ' + data_f + ' ';
    //     txt += '</label>';

    // }

    // if (partions >= 4) {
    //     var data_f = mes4.format('DD/MM/YYYY');
    //     txt += '<div class="radio"><label>';
    //     txt += '* Vencimento da 4° parcela: ' + data_f + ' ';
    //     txt += '</label>';
    // }

    // txt_parcelas += '<div class="radio"><label>';
    // txt_parcelas += '<b>Parcelas: </b>'+ partions + ' x ' + ($('#price_js').html() / partions).toFixed(2);
    // txt_parcelas += '</label>';

    // $('.js_radio_parts').html(txt);
    // $('.js_radio_parts_parcelas').html(txt_parcelas);
}

function change_payment_nohost(sel, price){
    var parcelas = $('select[name=installmentCount]');
    var partions = parcelas.val() ? parcelas.val() : 1;
    var txt_parcelas = '';
    var new_price = (price + (0.00*(partions-1)));
    $('#price_js').html(new_price.toFixed(2));
    
    txt_parcelas += '<div class="radio"><label>';
    txt_parcelas += '<b>Parcelas: </b>'+ partions + ' x ' + (new_price / partions).toFixed(2);
    txt_parcelas += '</label>';
    $('.js_radio_parts_parcelas').html(txt_parcelas);
}

function change_payment_nohost_pags(sel, price){
    $('#price_js_p').html((price).toFixed(2));
}

$(function() {
    /*
    var transport = $('#transport').val();
    if (transport === '') {
        $("#transport_check").prop("checked", false);
    } else {
        $("#transport_check").prop("checked", true);
    }

    $('#transport_check').click(function() {
        if ($('#transport_check').is(':checked')) {
            $("#transport").prop('disabled', false);
        } else {
            $("#transport").val('');
            $("#federation").prop('disabled', true);
        }
    });
    if ($('#transport_check').is(':checked')) {
        $("#transport").prop('disabled', false);
    } else {
        $("#transport").prop('disabled', true);
    }
    */
});


$('#cpf').formatter({
    'pattern': '{{999}}.{{999}}.{{999}}-{{99}}',
});
$('#birthday_picker').formatter({
    'pattern': '{{99}}/{{99}}/{{9999}}',
});
$('.progress').hide();
if ($("#edit_user_form").length) {
    $("#edit_user_form").validate({
        submitHandler: function(form) {
            // do other things for a valid form
            $('.progress').show();
            form.submit();
        },
        errorElement: 'div',
        errorPlacement: function(error, element) {
            var placement = $(element).data('error');
            if (placement) {
                $(placement).append(error);
            } else {
                error.insertAfter(element);
            }
        }
    });
    $("#name").rules("add", {
        required: true,
        messages: {
            required: "Preencha com nome completo"
        }
    });
    $("#rg").rules("add", {
        required: true,
        digits: true,
        messages: {
            required: "Entre com seu número de identidade",
            digits: "Preencha esse campo apenas com números"
        }
    });
    $("#cpf").rules("add", {
        required: true,
        rangelength: [11, 14],
        messages: {
            required: "Entre com seu cpf",
            rangelength: "O CPF deve possuir 11 dígitos"
        }
    });
    $("#birthday_picker").rules("add", {
        required: true,
        messages: {
            required: "Entre com sua data de nascimento",
        }
    });
    $("#university").rules("add", {
        required: true,
        messages: {
            required: "Informe a universidade da sua EJ"
        }
    });
    $("#curso").rules("add", {
        required: true,
        messages: {
            required: "Informe o seu curso"
        }
    });
    $("#semestre").rules("add", {
        required: true,
        messages: {
            required: "Informe o seu semestre"
        }
    });

    //  $( "#transport" ).rules( "add", {
    //    required: true,
    //    messages: {
    //      required: "Precisamos saber se precisa de transporte para o evento"
    //    }
    //  });
}

function popitup(url) {
    //newwindow=window.open(url,'Tire sua dúvida - EFEJ 2017','height=500,width=500');
    newwindow = window.open('https://drive.google.com/viewerng/viewer?url=http://www.efej.com.br/faq/faq_efej17.pdf', 'Tire sua dúvida - EFEJ 2017','height=500,width=500'); 
    if (window.focus) {newwindow.focus()}
    return false;
}


$('.preloader').hide();
$(window).load(function(){
  // Preloader
 $('.preloader').fadeOut('slow',function(){$(this).hide();});
});



$('body').on('shown.bs.modal', function () {
     $('.patrick-modal').find('.commit').on('click', function () {
      $('.preloader').show();
     });
});



